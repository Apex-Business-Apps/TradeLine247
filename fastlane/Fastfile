default_platform(:ios)
platform :ios do
  desc "Build & upload to TestFlight"
  lane :beta do
    app_identifier = ENV["APP_IDENTIFIER"]
    # Ensure Xcode-managed signing
    gym(
      workspace: "ios/App.xcworkspace",
      scheme: "App",
      clean: true,
      export_method: "app-store",
      silent: true
    )
    api_key = app_store_connect_api_key(
      key_id: ENV["ASC_API_KEY_ID"],
      issuer_id: ENV["ASC_API_ISSUER_ID"],
      key_content: ENV["ASC_API_KEY"],
      is_key_content_base64: false
    )
    upload_to_testflight(
      api_key: api_key,
      skip_waiting_for_build_processing: false,
      changelog: "Initial TestFlight build for TradeLine 24/7"
    )
  end
end
