# fastlane/Fastfile
# =============================================================================
# TradeLine 24/7 - Fastlane Configuration for Codemagic CI
# =============================================================================
# This Fastfile provides deterministic TestFlight uploads using App Store
# Connect API credentials provided via Codemagic environment variables.
# =============================================================================

default_platform(:ios)

platform :ios do
  lane :upload do
    api_key = app_store_connect_api_key(
      key_id: ENV.fetch("APP_STORE_CONNECT_KEY_IDENTIFIER"),
      issuer_id: ENV.fetch("APP_STORE_CONNECT_ISSUER_ID"),
      key_content: ENV.fetch("APP_STORE_CONNECT_PRIVATE_KEY"),
      is_key_content_base64: false,
      in_house: false
    )

    upload_to_testflight(
      api_key: api_key,
      ipa: ENV.fetch("IPA_PATH"),
      skip_waiting_for_build_processing: true
    )
  end
end
