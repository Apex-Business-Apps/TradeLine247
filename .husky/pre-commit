#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit Hook - Accessibility & Quality Checks
# Runs fast checks before allowing commits

echo "üîç Running pre-commit checks..."

# 1. Lint staged files
echo "üìã Linting..."
npx lint-staged

# 2. Type check (fast - no emit)
echo "üî§ Type checking..."
npm run typecheck

# 3. Quick accessibility scan on changed files
echo "‚ôø Checking accessibility tokens..."

# Check for direct color class violations in staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(tsx|ts|jsx|js)$' || true)

if [ -n "$STAGED_FILES" ]; then
  # Search for common violations
  VIOLATIONS=$(echo "$STAGED_FILES" | xargs grep -nE 'text-(red|green|blue|yellow|amber|orange)-(500|600|700|800|900)' || true)
  
  if [ -n "$VIOLATIONS" ]; then
    echo ""
    echo "‚ùå ACCESSIBILITY VIOLATION DETECTED"
    echo ""
    echo "Direct color classes found. Use semantic tokens instead:"
    echo ""
    echo "$VIOLATIONS"
    echo ""
    echo "Available semantic tokens:"
    echo "  ‚Ä¢ text-success, bg-success (green)"
    echo "  ‚Ä¢ text-warning, bg-warning (amber)"
    echo "  ‚Ä¢ text-error, bg-error (red)"
    echo "  ‚Ä¢ text-info, bg-info (blue)"
    echo ""
    echo "See tailwind.config.ts for full list."
    echo ""
    exit 1
  fi
fi

echo "‚úÖ All pre-commit checks passed!"
