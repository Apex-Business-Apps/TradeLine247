const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NewDashboard-Cg5opnMb.js","assets/react-query-DHkNQnk-.js","assets/react-vendor-a1y4eqJD.js","assets/index-Dpo-kh1j.js","assets/radix-primitives-BmowSk35.js","assets/radix-overlays-COL35z5_.js","assets/supabase-Ccy6tpTo.js","assets/react-router-DP697y4K.js","assets/radix-forms-DXrNnkJS.js","assets/index-BBzfy_hb.css","assets/calendar-WFnLrOV8.js","assets/circle-check-BQj80rBD.js","assets/circle-alert-DR1cr_I8.js","assets/refresh-cw-D8MiUO2G.js"])))=>i.map(i=>d[i]);
import{e,z as s,k as a,C as r,h as t,d as l,N as n,O as c,J as o,T as i,K as d,j as m,F as h,_ as u}from"./index-Dpo-kh1j.js";import{j as x}from"./react-query-DHkNQnk-.js";import{r as j}from"./react-vendor-a1y4eqJD.js";import{R as f}from"./refresh-cw-D8MiUO2G.js";const w=new Map,N=new Map;const p=async()=>{try{const{data:a,error:r}=await s.functions.invoke("dashboard-summary",{body:{},headers:{"Content-Type":"application/json"}});if(r)throw e.report({type:"error",message:`Dashboard API error: ${r.message||"Unknown error"}`,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:e.getEnvironment(),metadata:{error:r}}),new Error(`Dashboard API failed: ${r.message||"Unknown error"}`);if(!a)throw new Error("No data returned from dashboard API");return a}catch(a){throw e.report({type:"error",message:`Dashboard fetch error: ${a instanceof Error?a.message:"Unknown error"}`,stack:a instanceof Error?a.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:e.getEnvironment(),metadata:{error:a}}),a}},g=()=>{const{data:s,error:a,isLoading:r,isRefetching:t,refetch:l,invalidate:n,isStale:c}=function(e,s,a={}){const{cacheTime:r=3e5,staleTime:t=3e4,refetchOnWindowFocus:l=!0,retryAttempts:n=3}=a,[c,o]=j.useState(null),[i,d]=j.useState(null),[m,h]=j.useState(!0),[u,x]=j.useState(!1),f=j.useRef(0),p=j.useRef(null),g=j.useCallback(e=>{const s=w.get(e);return s?Date.now()-s.timestamp>s.ttl?(w.delete(e),null):s.data:null},[]),b=j.useCallback((e,s)=>{w.set(e,{data:s,timestamp:Date.now(),ttl:r})},[r]),y=j.useCallback(e=>{const s=w.get(e);return!s||Date.now()-s.timestamp>t},[t]),v=j.useCallback(async(a=!1)=>{var r,t;a?x(!0):h(!0);const l=N.get(e);if(l&&!a)try{const e=await l;return o(e),d(null),void h(!1)}catch(i){}p.current&&p.current.abort(),p.current=new AbortController;try{if(!a){const s=g(e);if(s&&!y(e))return o(s),d(null),void h(!1)}const t=s();N.set(e,t);const l=await t;if(null==(r=p.current)?void 0:r.signal.aborted)return;o(l),d(null),b(e,l),f.current=0}catch(i){if(null==(t=p.current)?void 0:t.signal.aborted)return;const s=i instanceof Error?i:new Error("Unknown error");if(f.current<n){f.current++;const e=Math.min(1e3*Math.pow(2,f.current-1),1e4);return void setTimeout(()=>{v(a)},e)}d(s);const r=g(e);r&&!c&&o(r)}finally{if(N.delete(e),h(!1),x(!1),w.size>50){const e=Array.from(w.entries()),s=Date.now(),a=e.sort((e,s)=>e[1].timestamp-s[1].timestamp);for(let r=0;r<e.length-50;r++)w.delete(a[r][0]);e.forEach(([e,a])=>{s-a.timestamp>18e5&&w.delete(e)})}}},[e,s,g,b,y,n,c]),k=j.useCallback(()=>(f.current=0,v(!0)),[v]),A=j.useCallback(()=>{w.delete(e),k()},[e,k]);return j.useEffect(()=>(v(),()=>{p.current&&p.current.abort()}),[v]),j.useEffect(()=>{if(!l)return;const s=()=>{y(e)&&k()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[l,y,e,k]),{data:c,error:i,isLoading:m,isRefetching:u,refetch:k,invalidate:A,isStale:y(e)}}("dashboard-summary",p,{cacheTime:3e5,staleTime:6e4,refetchOnWindowFocus:!0,retryAttempts:3}),o=j.useCallback(s=>{if(!s)return"Unknown";try{const e=new Date,a=new Date(s),r=e.getTime()-a.getTime(),t=Math.floor(r/6e4);if(t<1)return"Just now";if(t<60)return`${t}m ago`;const l=Math.floor(t/60);if(l<24)return`${l}h ago`;return`${Math.floor(l/24)}d ago`}catch(a){return e.report({type:"error",message:`Date parsing error: ${a instanceof Error?a.message:"Unknown error"}`,stack:a instanceof Error?a.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:e.getEnvironment(),metadata:{isoString:s,error:a}}),"Unknown"}},[]),i=j.useCallback(()=>a?a.message.includes("Failed to fetch")||a.message.includes("network")?"Couldn't refresh right now. Check your connection":a.message.includes("timeout")?"Taking longer than usual. We'll keep trying":a.message.includes("No data returned")?"Dashboard service is starting up. Please wait":"Something's not quite right. We're looking into it":"",[a]),d=(null==s?void 0:s.lastUpdated)?`Last updated ${o(s.lastUpdated)}`:"",m=j.useCallback(()=>{n()},[n]);return{kpis:(null==s?void 0:s.kpis)||[],nextItems:(null==s?void 0:s.nextItems)||[],transcripts:(null==s?void 0:s.transcripts)||[],isLoading:r,isRefetching:t,error:a?i():null,lastUpdated:d,refresh:l,forceRefresh:m,hasData:!!s,isStale:c}};function b({className:e,...s}){return x.jsx("div",{className:a("animate-pulse rounded-md bg-muted",e),...s})}const y=({layout:e="comfortable"})=>{const s="compact"===e?"space-y-4":"spacious"===e?"space-y-8":"space-y-6",a="compact"===e?"gap-3":"spacious"===e?"gap-6":"gap-4";return x.jsxs("div",{className:s,children:[x.jsx("div",{className:"rounded-lg border bg-card p-6",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"space-y-3 flex-1",children:[x.jsx(b,{className:"h-8 w-64"}),x.jsx(b,{className:"h-4 w-96"})]}),x.jsx(b,{className:"h-10 w-10 rounded-full"})]})}),x.jsx("div",{className:`grid grid-cols-2 md:grid-cols-4 ${a}`,children:Array.from({length:4}).map((e,s)=>x.jsx(r,{className:"relative overflow-hidden border-0 shadow-sm",children:x.jsxs(t,{className:"p-4",children:[x.jsxs("div",{className:"flex items-start justify-between mb-3",children:[x.jsx(b,{className:"h-10 w-10 rounded-md"}),x.jsx(b,{className:"h-5 w-12"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(b,{className:"h-8 w-20"}),x.jsx(b,{className:"h-4 w-32"}),x.jsx(b,{className:"h-3 w-28"})]})]})},s))}),x.jsxs("div",{className:`grid grid-cols-1 lg:grid-cols-3 ${a}`,children:[x.jsxs("div",{className:`lg:col-span-2 ${s}`,children:[x.jsxs(r,{className:"shadow-sm",children:[x.jsx(l,{className:"border-b",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx(b,{className:"h-6 w-32"}),x.jsx(b,{className:"h-5 w-5 rounded-full"})]})}),x.jsx(t,{className:"p-4",children:x.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((e,s)=>x.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-md bg-muted/30",children:[x.jsx(b,{className:"h-5 w-5 rounded-full"}),x.jsxs("div",{className:"flex-1 space-y-2",children:[x.jsx(b,{className:"h-4 w-3/4"}),x.jsx(b,{className:"h-3 w-1/2"})]}),x.jsx(b,{className:"h-8 w-20 rounded-md"})]},s))})})]}),x.jsxs(r,{className:"shadow-sm",children:[x.jsx(l,{className:"border-b",children:x.jsx(b,{className:"h-6 w-40"})}),x.jsx(t,{className:"p-4",children:x.jsx("div",{className:"space-y-3",children:Array.from({length:2}).map((e,s)=>x.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-md bg-muted/20",children:[x.jsx(b,{className:"h-8 w-8 rounded-full"}),x.jsxs("div",{className:"flex-1 space-y-2",children:[x.jsx(b,{className:"h-4 w-full"}),x.jsx(b,{className:"h-3 w-3/4"})]})]},s))})})]}),x.jsxs(r,{className:"shadow-sm",children:[x.jsx(l,{className:"border-b",children:x.jsx(b,{className:"h-6 w-36"})}),x.jsx(t,{className:"p-4",children:x.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((e,s)=>x.jsxs("div",{className:"space-y-2 pb-4 border-b last:border-0",children:[x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsx(b,{className:"h-5 w-32"}),x.jsx(b,{className:"h-4 w-20"})]}),x.jsx(b,{className:"h-3 w-full"}),x.jsx(b,{className:"h-3 w-4/5"}),x.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[x.jsx(b,{className:"h-6 w-16 rounded-full"}),x.jsx(b,{className:"h-6 w-20 rounded-full"})]})]},s))})})]})]}),x.jsxs("div",{className:s,children:[x.jsxs(r,{className:"shadow-sm",children:[x.jsx(l,{className:"border-b",children:x.jsx(b,{className:"h-6 w-32"})}),x.jsx(t,{className:"p-4",children:x.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((e,s)=>x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(b,{className:"h-10 w-10 rounded-md"}),x.jsxs("div",{className:"flex-1 space-y-2",children:[x.jsx(b,{className:"h-4 w-28"}),x.jsx(b,{className:"h-3 w-36"})]})]},s))})})]}),x.jsxs(r,{className:"shadow-sm",children:[x.jsx(l,{className:"border-b",children:x.jsx(b,{className:"h-6 w-32"})}),x.jsx(t,{className:"p-4",children:x.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((e,s)=>x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(b,{className:"h-2 w-2 rounded-full"}),x.jsx(b,{className:"h-4 w-24"})]}),x.jsx(b,{className:"h-5 w-20 rounded-full"})]},s))})})]}),x.jsxs(r,{className:"shadow-sm border-primary/20 bg-primary/5",children:[x.jsx(l,{className:"border-b border-primary/10",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(b,{className:"h-5 w-5 rounded-full"}),x.jsx(b,{className:"h-5 w-24"})]})}),x.jsx(t,{className:"p-4",children:x.jsxs("div",{className:"space-y-3",children:[x.jsx(b,{className:"h-4 w-full"}),x.jsx(b,{className:"h-4 w-5/6"}),x.jsx(b,{className:"h-8 w-28 rounded-md mt-3"})]})})]})]})]}),x.jsxs("div",{className:"text-center py-4",children:[x.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 rounded-full bg-muted/50",children:[x.jsx("div",{className:"h-4 w-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),x.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading your dashboard..."})]}),x.jsx("p",{className:"text-xs text-muted-foreground/70 mt-2",children:"This usually takes a few seconds"})]})]})},v=j.lazy(()=>u(()=>import("./NewDashboard-Cg5opnMb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(e=>({default:e.NewDashboard}))),k=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{t:e}=n("dashboard"),{error:s,lastUpdated:a,refresh:r}=g(),{dashboardLayout:t,translationsEnabled:l}=c(),u=l?e("title"):"Dashboard",w=l?e("welcome.subtitle"):"Your AI receptionist is working hard for you today",N=l?e("actions.try_again"):"Try again";return x.jsxs("main",{className:"dashboard-shell min-h-screen bg-background",children:[x.jsxs("div",{className:"container mx-auto px-4 py-8",children:[x.jsxs("div",{className:"mb-8",children:[x.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:u}),x.jsx("p",{className:"text-sm text-muted-foreground",children:w})]}),s&&x.jsxs(o,{className:"mb-6 border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-900/20",children:[x.jsx(i,{className:"h-4 w-4 text-amber-800 dark:text-yellow-400"}),x.jsxs(d,{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-yellow-800 dark:text-yellow-300",children:s}),x.jsxs(m,{onClick:r,variant:"outline",size:"sm",className:"ml-4 h-auto px-3 py-1 text-xs",children:[x.jsx(f,{className:"h-3 w-3 mr-1"}),N]})]})]}),a&&x.jsx("div",{className:"text-xs text-muted-foreground mb-6 text-center",children:a}),x.jsx(j.Suspense,{fallback:x.jsx(y,{layout:t||"comfortable"}),children:x.jsx(v,{})})]}),x.jsx(h,{})]})}},Symbol.toStringTag,{value:"Module"}));export{k as C,b as S,g as u};
