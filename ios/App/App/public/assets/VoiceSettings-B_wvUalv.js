import{j as e}from"./react-query-DHkNQnk-.js";import{r as s}from"./react-vendor-a1y4eqJD.js";import{k as a,o as l,z as i,j as n,T as r,J as c,K as t,C as d,d as o,f as m,n as u,g as x,h,L as p,v as j,$ as v,I as g,Z as f,B as _,a1 as b,S as y}from"./index-Dpo-kh1j.js";import{S as N,a as w,b as k,c as S,d as A}from"./select-DFqwvI9t.js";import{b as C,T as M,c as B,d as V,e as P,f as R}from"./radix-forms-DXrNnkJS.js";import{T,a as D,b as F,c as I}from"./tabs-Cvu1gGbT.js";import{M as E}from"./message-square-BhNav3br.js";import"./radix-primitives-BmowSk35.js";import"./radix-overlays-COL35z5_.js";import"./supabase-Ccy6tpTo.js";import"./react-router-DP697y4K.js";const L=s.forwardRef(({className:s,...l},i)=>e.jsxs(C,{ref:i,className:a("relative flex w-full touch-none select-none items-center",s),...l,children:[e.jsx(M,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(B,{className:"absolute h-full bg-primary"})}),e.jsx(V,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));L.displayName=C.displayName;const H=s.forwardRef(({className:s,...l},i)=>e.jsx(P,{className:a("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",s),...l,ref:i,children:e.jsx(R,{className:a("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));H.displayName=P.displayName;const O=[{value:"alloy",label:"Alloy (Neutral)"},{value:"echo",label:"Echo (Male)"},{value:"fable",label:"Fable (British Male)"},{value:"onyx",label:"Onyx (Deep Male)"},{value:"nova",label:"Nova (Female)"},{value:"shimmer",label:"Shimmer (Warm Female)"}];function Y(){var a;const[C,M]=s.useState(null),[B,V]=s.useState([]),[P,R]=s.useState(!0),[Y,z]=s.useState(!1),[U,Z]=s.useState(!1),[q,G]=s.useState(!1),{toast:K}=l();s.useEffect(()=>{W(),$()},[]);const W=async()=>{try{const{data:e,error:s}=await i.from("voice_config").select("*").single();if(s&&"PGRST116"!==s.code)throw s;M(e||{pickup_mode:"immediate",rings_before_pickup:2,llm_enabled:!0,llm_voice:"alloy",llm_speaking_rate:1,llm_max_reply_seconds:15,system_prompt:"",amd_enable:!0,ringback_tone:"default",max_ring_reroutes:3,fail_open:!1,business_name:"Apex Business Systems",human_number_e164:"+14319900222",active_preset_id:null}),G("never"===(null==e?void 0:e.pickup_mode)&&!(null==e?void 0:e.llm_enabled))}catch(e){K({title:"Failed to load config",description:e.message,variant:"destructive"})}finally{R(!1)}},$=async()=>{try{const{data:e,error:s}=await i.from("voice_presets").select("*").order("id");if(s)throw s;V(e||[])}catch(e){console.error("Failed to load presets:",e)}},J=async e=>{if(Y)return;const s=C,a={...C,...e};z(!0),M(a);try{const{data:e,error:s}=await i.functions.invoke("ops-voice-config-update",{body:a});if(s)throw s;(null==e?void 0:e.ok)||console.warn("Voice config update responded without ok flag",e),K({title:"Settings Saved",description:"Voice configuration updated successfully"})}catch(l){console.error("Failed to save voice configuration",l),M(s),K({title:"Save Failed",description:(null==l?void 0:l.message)??"Unable to save changes right now.",variant:"destructive"})}finally{z(!1)}},Q=e=>e.replace(/\{BusinessName\}/g,(null==C?void 0:C.business_name)||"Apex Business Systems").replace(/\{HumanNumberE164\}/g,(null==C?void 0:C.human_number_e164)||"+14319900222");return P?e.jsx("div",{className:"container max-w-6xl py-8",children:"Loading..."}):e.jsxs("div",{className:"container max-w-6xl py-8 space-y-6","aria-busy":Y,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Voice Settings"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure AI voice assistant and call handling"})]}),e.jsxs(n,{variant:q?"default":"destructive",size:"lg",onClick:async()=>{const e=!q;G(e),await J({pickup_mode:"never",llm_enabled:!1}),K({title:e?"ðŸš¨ Panic Mode Activated":"Panic Mode Deactivated",description:e?"All calls will be bridged directly. No LLM processing.":"Voice AI settings restored",variant:e?"destructive":"default"})},className:"gap-2",children:[e.jsx(r,{className:"w-5 h-5"}),q?"Exit Panic Mode":"ðŸš¨ Panic: Bridge All Calls"]})]}),q&&e.jsxs(c,{variant:"destructive",children:[e.jsx(r,{className:"h-4 w-4"}),e.jsxs(t,{children:[e.jsx("strong",{children:"Panic Mode Active:"})," All calls are being bridged directly to ",(null==C?void 0:C.ring_target)||"+14319900222",". LLM processing is disabled."]})]}),e.jsxs(T,{defaultValue:"basic",className:"space-y-6",children:[e.jsxs(D,{className:"grid w-full grid-cols-3",children:[e.jsx(F,{value:"basic",children:"Basic Settings"}),e.jsx(F,{value:"presets",children:"Quick Presets"}),e.jsx(F,{value:"advanced",children:"Advanced"})]}),e.jsxs(I,{value:"basic",className:"space-y-6",children:[e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5"}),"Pickup Mode"]}),e.jsx(x,{children:"When should the AI answer incoming calls?"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Mode"}),e.jsxs(N,{value:null==C?void 0:C.pickup_mode,onValueChange:e=>J({pickup_mode:e}),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(A,{value:"immediate",children:"Immediate (AI answers right away)"}),e.jsx(A,{value:"after_rings",children:"After N Rings (try human first)"}),e.jsx(A,{value:"never",children:"Never (bridge only)"})]})]})]}),"after_rings"===(null==C?void 0:C.pickup_mode)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Rings Before Pickup: ",null==C?void 0:C.rings_before_pickup]}),e.jsx(L,{value:[(null==C?void 0:C.rings_before_pickup)||2],onValueChange:([e])=>J({rings_before_pickup:e}),min:1,max:6,step:1,className:"w-full"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["~",5*((null==C?void 0:C.rings_before_pickup)||2)," seconds"]})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Voice & Speech"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Enable LLM Voice"}),e.jsx(H,{checked:null==C?void 0:C.llm_enabled,onCheckedChange:e=>J({llm_enabled:e})})]}),(null==C?void 0:C.llm_enabled)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Voice"}),e.jsxs(N,{value:null==C?void 0:C.llm_voice,onValueChange:e=>J({llm_voice:e}),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsx(S,{children:O.map(s=>e.jsx(A,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Speaking Rate: ",null==(a=null==C?void 0:C.llm_speaking_rate)?void 0:a.toFixed(1),"x"]}),e.jsx(L,{value:[(null==C?void 0:C.llm_speaking_rate)||1],onValueChange:([e])=>J({llm_speaking_rate:e}),min:.5,max:2,step:.1,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Max Reply Length: ",null==C?void 0:C.llm_max_reply_seconds,"s"]}),e.jsx(L,{value:[(null==C?void 0:C.llm_max_reply_seconds)||15],onValueChange:([e])=>J({llm_max_reply_seconds:e}),min:5,max:30,step:1,className:"w-full"})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"System Prompt"}),e.jsx(x,{children:"Instructions for how the AI should behave"})]}),e.jsx(h,{children:e.jsx(j,{value:(null==C?void 0:C.system_prompt)||"",onChange:e=>M({...C,system_prompt:e.target.value}),onBlur:()=>J({system_prompt:null==C?void 0:C.system_prompt}),rows:6,className:"font-mono text-sm"})})]})]}),e.jsxs(I,{value:"presets",className:"space-y-4",children:[e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Preset Tokens"]}),e.jsx(x,{children:"These tokens are replaced in all preset prompts"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Business Name"}),e.jsx(g,{value:(null==C?void 0:C.business_name)||"",onChange:e=>M({...C,business_name:e.target.value}),onBlur:()=>J({business_name:null==C?void 0:C.business_name}),placeholder:"Apex Business Systems"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Token: ","{BusinessName}"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Human Number (E.164)"}),e.jsx(g,{value:(null==C?void 0:C.human_number_e164)||"",onChange:e=>M({...C,human_number_e164:e.target.value}),onBlur:()=>J({human_number_e164:null==C?void 0:C.human_number_e164}),placeholder:"+14319900222"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Token: ","{HumanNumberE164}"]})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Prompt Presets"]}),e.jsx(x,{children:"One-click configurations with token replacement"})]}),e.jsx(h,{className:"space-y-3",children:B.map(s=>{const a=(null==C?void 0:C.active_preset_id)===s.id,l=Q(s.system_prompt);return e.jsxs(d,{className:a?"border-primary":"",children:[e.jsx(o,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"text-lg",children:s.label}),a&&e.jsxs(_,{variant:"default",className:"gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),"Active"]})]}),e.jsx(n,{size:"sm",onClick:()=>(async e=>{const s=B.find(s=>s.id===e);if(!s)return;const a=Q(s.system_prompt);await J({system_prompt:a,active_preset_id:e,llm_max_reply_seconds:s.max_reply_seconds,llm_speaking_rate:s.speaking_rate,llm_voice:s.voice}),K({title:"Preset Applied",description:`${s.label} preset is now active`})})(s.id),disabled:Y||a,children:a?"Applied":"Apply"})]})}),e.jsxs(h,{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("strong",{children:"Preview (with tokens resolved):"})}),e.jsxs("div",{className:"text-xs bg-muted p-3 rounded-md font-mono whitespace-pre-wrap max-h-32 overflow-y-auto",children:[l.substring(0,300),l.length>300&&"..."]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2",children:[e.jsxs("span",{children:["Voice: ",s.voice]}),e.jsxs("span",{children:["Rate: ",s.speaking_rate,"x"]}),e.jsxs("span",{children:["Max: ",s.max_reply_seconds,"s"]})]})]})]},s.id)})})]}),e.jsxs(c,{children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs(t,{children:[e.jsx("strong",{children:"Global Rules (applied to all presets):"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm space-y-1",children:[e.jsx("li",{children:"Stop recording if caller declines consent; continue with minimal notes"}),e.jsx("li",{children:"Silence â‰¥6s: brief nudge once; on second silence, bridge to human"}),e.jsx("li",{children:"Low confidence on â‰¥2 fields â†’ offer transfer"}),e.jsx("li",{children:"Email transcript with subject: [Call Transcript] CallerID YYYY-MM-DD HH:mm TZ"})]})]})]})]}),e.jsxs(I,{value:"advanced",className:"space-y-4",children:[e.jsxs(c,{children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs(t,{children:[e.jsx("strong",{children:"Advanced Settings:"})," These options affect low-level call handling behavior. Only modify if you understand the implications."]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"AMD & Detection"})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Enable AMD (Answering Machine Detection)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Detect voicemail and skip"})]}),e.jsx(H,{checked:null==C?void 0:C.amd_enable,onCheckedChange:e=>J({amd_enable:e})})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Ring Behavior"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Ring Target (E.164)"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-md",value:(null==C?void 0:C.ring_target)||"",onChange:e=>M({...C,ring_target:e.target.value}),onBlur:()=>J({ring_target:null==C?void 0:C.ring_target}),placeholder:"+14319900222"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Max Ring Reroutes: ",null==C?void 0:C.max_ring_reroutes]}),e.jsx(L,{value:[(null==C?void 0:C.max_ring_reroutes)||3],onValueChange:([e])=>J({max_ring_reroutes:e}),min:1,max:10,step:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Ringback Tone"}),e.jsxs(N,{value:null==C?void 0:C.ringback_tone,onValueChange:e=>J({ringback_tone:e}),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(A,{value:"default",children:"Default"}),e.jsx(A,{value:"us",children:"US Standard"}),e.jsx(A,{value:"uk",children:"UK Standard"}),e.jsx(A,{value:"silence",children:"Silence"})]})]})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Failure Handling"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Fail Open"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If AI fails, connect the call anyway"})]}),e.jsx(H,{checked:null==C?void 0:C.fail_open,onCheckedChange:e=>J({fail_open:e})})]})})]})]})]})]})}export{Y as default};
