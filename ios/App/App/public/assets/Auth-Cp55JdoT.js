import{j as e}from"./react-query-DHkNQnk-.js";import{r as s}from"./react-vendor-a1y4eqJD.js";import{z as a,e as r,D as t,E as n,p as i,b as o,C as l,d as c,f as d,g as u,h as m,J as h,K as g,L as p,I as w,j as v,w as x,F as f}from"./index-Dpo-kh1j.js";import{T as y,a as j,b,c as S}from"./tabs-Cvu1gGbT.js";import{c as k}from"./brandGradients-KgJGh5c5.js";import{u as N}from"./react-router-DP697y4K.js";import"./radix-primitives-BmowSk35.js";import"./radix-overlays-COL35z5_.js";import"./supabase-Ccy6tpTo.js";import"./radix-forms-DXrNnkJS.js";const P=()=>{const[P,E]=s.useState(""),[A,B]=s.useState(""),[T,V]=s.useState(""),[C,I]=s.useState(!1),[D,q]=s.useState(null),[$,O]=s.useState(null),[z,F]=s.useState(null),[L,U]=s.useState(null),[G,R]=s.useState(""),[W,Z]=s.useState(!1),[J,K]=s.useState(!1),_=N(),{validatePassword:H}=(()=>{const e=s.useCallback(async e=>{try{if(!e||e.length<1)return{isBreached:!1,message:"Password required"};const{data:s,error:t}=await a.functions.invoke("check-password-breach",{body:{password:e}});return t?(r.report({type:"error",message:`Password breach check error: ${t.message}`,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:r.getEnvironment(),metadata:{error:t}}),{isBreached:!1,message:"Password check service temporarily unavailable",error:t.message}):{isBreached:(null==s?void 0:s.isBreached)||!1,message:(null==s?void 0:s.message)||"Password check completed",error:null==s?void 0:s.error}}catch(D){return r.report({type:"error",message:`Password security check failed: ${D instanceof Error?D.message:"Unknown error"}`,stack:D instanceof Error?D.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:r.getEnvironment(),metadata:{error:D}}),{isBreached:!1,message:"Password check service error",error:D instanceof Error?D.message:"Unknown error"}}},[]),t=s.useCallback(e=>{if(e.length<8)return{isValid:!1,strength:"Too short",message:"Password must be at least 8 characters long"};const s=[/[a-z]/.test(e),/[A-Z]/.test(e),/\d/.test(e),/[!@#$%^&*(),.?":{}|<>]/.test(e)].filter(Boolean).length;return s<3?{isValid:!1,strength:"Too weak",message:"Password must contain at least 3 of: lowercase, uppercase, number, special character"}:{isValid:!0,strength:4===s?"Very strong":"Good"}},[]),n=s.useCallback(async s=>{const a=t(s);if(!a.isValid)return{isValid:!1,strength:a.strength,isBreached:!1,message:a.message};const r=await e(s);return{isValid:!r.isBreached,strength:a.strength,isBreached:r.isBreached,message:r.isBreached?r.message:void 0}},[t,e]);return{checkPasswordBreach:e,validatePasswordStrength:t,validatePassword:n}})(),{user:M,loading:Q}=t();s.useEffect(()=>{if(!n||!a)return I(!1),()=>{};const{data:{subscription:e}}=a.auth.onAuthStateChange((e,s)=>{U(s),F((null==s?void 0:s.user)??null),(null==s?void 0:s.user)&&_(i.dashboard)});return a.auth.getSession().then(({data:{session:e},error:s})=>{var t,n;if((null==(t=null==s?void 0:s.message)?void 0:t.includes("malformed"))||(null==(n=null==s?void 0:s.message)?void 0:n.includes("invalid")))return r.report({type:"error",message:`Auth: Detected malformed token, clearing session: ${s.message}`,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:r.getEnvironment()}),a.auth.signOut().catch(()=>{}),U(null),void F(null);U(e),F((null==e?void 0:e.user)??null),(null==e?void 0:e.user)&&_(i.dashboard)}).catch(e=>{r.report({type:"error",message:`Auth: Session check failed: ${(null==e?void 0:e.message)||e}`,stack:null==e?void 0:e.stack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:r.getEnvironment()}),a.auth.signOut().catch(()=>{}),U(null),F(null)}),()=>e.unsubscribe()},[_]),s.useEffect(()=>{!Q&&M&&_(i.dashboard,{replace:!0})},[Q,M,_]);const X=async e=>{B(e),Z(!0),K(!1);try{const s=(e=>{if(e.length<8)return{isValid:!1,strength:"Too short",message:"Password must be at least 8 characters long"};const s=[/[a-z]/.test(e),/[A-Z]/.test(e),/\d/.test(e),/[!@#$%^&*(),.?":{}|<>]/.test(e)].filter(Boolean).length;return s<3?{isValid:!1,strength:"Weak",message:"Password must contain at least 3 of: lowercase, uppercase, number, special character"}:{isValid:!0,strength:4===s?"Strong":"Good"}})(e);if(R(s.strength),s.isValid&&e.length>=8){const s=await H(e);R(s.strength),K(s.isBreached),s.isBreached?q(s.message||"This password appears in known data breaches"):q(null)}}catch(s){r.report({type:"error",message:`Password validation error: ${s}`,stack:s instanceof Error?s.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:r.getEnvironment()})}finally{Z(!1)}};if(Q)return e.jsx("div",{className:"w-full py-8 text-center text-sm text-slate-500",children:"Loading…"});if(M)return e.jsx("div",{className:"w-full py-8 text-center text-sm text-slate-500",children:"Redirecting to your dashboard…"});const Y=k();return e.jsxs("div",{className:"min-h-screen flex flex-col relative",style:Y,children:[e.jsx("div",{className:"fixed inset-0 -z-[1]",style:{backgroundImage:`url(${o})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",pointerEvents:"none"},"aria-hidden":"true"}),e.jsx("h1",{className:"sr-only",children:"TradeLine 24/7 Authentication"}),e.jsx("div",{className:"relative z-10 flex-1 container py-8 px-4 flex items-center justify-center",children:e.jsxs(l,{className:"w-full max-w-md",children:[e.jsxs(c,{className:"text-center",children:[e.jsx(d,{className:"text-2xl",children:"Welcome to TradeLine 24/7"}),e.jsx(u,{children:"Sign in to your account or create a new one"})]}),e.jsx(m,{children:e.jsxs(y,{defaultValue:"signin",className:"space-y-4",children:[e.jsxs(j,{className:"grid w-full grid-cols-2",children:[e.jsx(b,{value:"signin",children:"Sign In"}),e.jsx(b,{value:"signup",children:"Sign Up"})]}),D&&e.jsx(h,{variant:"destructive",children:e.jsx(g,{children:D})}),$&&e.jsx(h,{children:e.jsx(g,{children:$})}),e.jsx(S,{value:"signin",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P&&A){I(!0),q(null);try{const{error:e}=await(async(e,s)=>{if(!n)throw new Error("Supabase is disabled in this environment.");const{error:r}=await a.auth.signInWithPassword({email:e,password:s});return{error:r}})(P,A);e?(e.message.includes("Invalid login credentials")?q("Invalid email or password. Please check your credentials."):q(e.message),I(!1)):_(i.dashboard)}catch(s){q(s.message||"An error occurred during sign in"),I(!1)}}else q("Please fill in all fields")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"signin-email",children:"Email"}),e.jsx(w,{id:"signin-email",type:"email",placeholder:"Enter your email",value:P,onChange:e=>E(e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"signin-password",children:"Password"}),e.jsx(w,{id:"signin-password",type:"password",placeholder:"Enter your password",value:A,onChange:e=>B(e.target.value),required:!0})]}),e.jsxs(v,{type:"submit",variant:"success",className:"w-full",disabled:C,children:[C&&e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]})}),e.jsx(S,{value:"signup",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P&&A&&T){I(!0),q(null),O(null);try{const{error:e}=await(async(e,s,r)=>{const t=await H(s);if(!t.isValid)throw new Error(t.message||"Password does not meet security requirements");if(t.isBreached)throw new Error("This password appears in known data breaches. Please choose a different password.");const i=`${window.location.origin}/`;if(!n)throw new Error("Supabase is disabled in this environment.");const{error:o}=await a.auth.signUp({email:e,password:s,options:{emailRedirectTo:i,data:{display_name:r}}});return{error:o}})(P,A,T);e?(e.message.includes("already registered")?q("This email is already registered. Please sign in instead."):q(e.message),I(!1)):(O("Account created successfully! Please check your email to verify your account."),I(!1),E(""),B(""),V(""))}catch(s){q(s.message||"An error occurred during sign up"),I(!1)}}else q("Please fill in all fields")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"signup-name",children:"Display Name"}),e.jsx(w,{id:"signup-name",type:"text",placeholder:"Enter your name",value:T,onChange:e=>V(e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"signup-email",children:"Email"}),e.jsx(w,{id:"signup-email",type:"email",placeholder:"Enter your email",value:P,onChange:e=>E(e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"signup-password",children:"Password"}),e.jsx(w,{id:"signup-password",type:"password",placeholder:"Create a strong password",value:A,onChange:e=>X(e.target.value),required:!0,minLength:8}),A&&e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Strength: "}),e.jsxs("span",{className:"font-medium "+("Very strong"===G||"Strong"===G?"text-[hsl(142,85%,25%)]":"Good"===G?"text-amber-800":"text-red-700"),children:[G,W&&e.jsx(x,{className:"inline w-3 h-3 ml-1 animate-spin"})]})]}),J&&e.jsx("div",{className:"text-xs text-red-700 font-medium",children:"⚠️ This password appears in known data breaches. Please choose a different password."}),A.length>=8&&!J&&"Too short"!==G&&e.jsx("div",{className:"text-xs text-[hsl(142,85%,25%)]",children:"✓ Password meets security requirements"}),("Too short"===G||"Weak"===G||"Too weak"===G)&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Use 8+ characters with uppercase, lowercase, numbers, and symbols"})]})]}),e.jsxs(v,{type:"submit",variant:"success",className:"w-full",disabled:C,children:[C&&e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]})})]})})]})}),e.jsx(f,{})]})};export{P as default};
