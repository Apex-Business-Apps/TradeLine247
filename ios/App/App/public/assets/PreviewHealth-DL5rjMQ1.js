import{j as e}from"./react-query-DHkNQnk-.js";import{r as s}from"./react-vendor-a1y4eqJD.js";import{a8 as t,j as a,C as n,d as r,f as i,g as o,h as l,l as c,B as d,i as m,a9 as h}from"./index-Dpo-kh1j.js";import{R as u,a as p,b as w}from"./index-vtRuxzTU.js";import{R as x}from"./refresh-cw-D8MiUO2G.js";import{C as g}from"./circle-x-CEMfQcIp.js";import{C as f}from"./circle-alert-DR1cr_I8.js";import{S as v}from"./SEOHead-kuKOPqIt.js";import{c as j}from"./react-router-DP697y4K.js";import"./radix-primitives-BmowSk35.js";import"./radix-overlays-COL35z5_.js";import"./supabase-Ccy6tpTo.js";import"./radix-forms-DXrNnkJS.js";if("undefined"!=typeof window){window.__RECENT_ERRORS__=[];const e=console.error;console.error=(...s)=>{const t=window.__RECENT_ERRORS__||[];t.push({message:s.join(" "),timestamp:(new Date).toISOString()}),t.length>20&&t.shift(),window.__RECENT_ERRORS__=t,e.apply(console,s)}}const y=u,N=p,b=w,E=["lovableproject.com","lovable.app","lovable.dev","gptengineer.app"];function S(e){const s=e.toLowerCase();return s.includes(".lovable.")||E.some(e=>s===e||s.endsWith(`.${e}`))}function R(){const[h,u]=s.useState(null),[p,w]=s.useState(!1),[v,j]=s.useState(!1);s.useEffect(()=>{(S(window.location.hostname)||!1)&&E()},[]);const E=async()=>{w(!0);try{const e=await async function(){const e=[],s=window.location.hostname,a=s.toLowerCase(),n=a.includes(".lovable.")||["lovableproject.com","lovable.app","lovable.dev","gptengineer.app"].some(e=>a===e||a.endsWith(`.${e}`));e.push({name:"Environment Detection",status:n?"pass":"warn",message:n?"Preview environment detected":"Not a preview environment",details:{hostname:s,isPreview:n}});const r=document.getElementById("root"),i=!!r&&"none"!==window.getComputedStyle(r).display,o=r?window.getComputedStyle(r).opacity:"0";if(e.push({name:"Root Element Visibility",status:i&&parseFloat(o)>0?"pass":"fail",message:i?"Root element is visible":"Root element is hidden",details:{exists:!!r,visible:i,opacity:o,display:r?window.getComputedStyle(r).display:"N/A"}}),"serviceWorker"in navigator){const s=await navigator.serviceWorker.getRegistrations(),t=s.length>0?"active":"none";e.push({name:"Service Worker",status:0===s.length?"pass":"warn",message:`Service worker ${t}`,details:{count:s.length,dev:!1,registrations:s.map(e=>e.scope)}})}const l=t(window.location.search);e.push({name:"Safe Mode",status:l?"warn":"pass",message:l?"Safe mode active":"Normal mode",details:{safeMode:l,url:window.location.href}});const c=!!window.__ERROR_BOUNDARY_ACTIVE__;e.push({name:"Error Boundaries",status:"pass",message:"Error boundaries loaded",details:{active:c}});const d=window.__RECENT_ERRORS__||[];e.push({name:"Console Errors",status:0===d.length?"pass":"warn",message:`${d.length} recent errors`,details:{errors:d.slice(-5)}});const m=navigator.onLine;if(e.push({name:"Network Connectivity",status:m?"pass":"fail",message:m?"Online":"Offline",details:{online:m}}),window.performance&&window.performance.timing){const s=window.performance.timing,t=s.loadEventEnd-s.navigationStart;e.push({name:"Page Load Time",status:t<3e3?"pass":t<5e3?"warn":"fail",message:`${t}ms`,details:{loadTime:t,timing:{dns:s.domainLookupEnd-s.domainLookupStart,tcp:s.connectEnd-s.connectStart,ttfb:s.responseStart-s.requestStart,download:s.responseEnd-s.responseStart,domReady:s.domContentLoadedEventEnd-s.navigationStart}}})}const h=e.some(e=>"fail"===e.status),u=e.some(e=>"warn"===e.status);return{status:h?"error":u?"warning":"healthy",checks:e,timestamp:(new Date).toISOString(),environment:s}}();u(e),"healthy"!==e.status&&j(!0)}finally{w(!1)}};if(!S(window.location.hostname))return null;const R=s=>{switch(s){case"pass":return e.jsx(m,{className:"w-4 h-4 text-success"});case"warn":return e.jsx(f,{className:"w-4 h-4 text-amber-800"});case"fail":return e.jsx(g,{className:"w-4 h-4 text-error"});default:return null}};return v?e.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] w-96 max-h-[80vh] overflow-auto",children:e.jsxs(n,{className:"shadow-2xl",children:[e.jsxs(r,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-lg",children:"Preview Diagnostics"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{onClick:E,disabled:p,size:"sm",variant:"ghost","aria-label":"Refresh diagnostics",children:e.jsx(x,{className:"w-4 h-4 "+(p?"animate-spin":"")})}),e.jsx(a,{onClick:()=>j(!1),size:"sm",variant:"ghost","aria-label":"Close diagnostics panel",children:"âœ•"})]})]}),e.jsx(o,{children:h&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[(s=>{switch(s){case"healthy":return e.jsx(d,{className:"bg-green-700",children:"Healthy"});case"warning":return e.jsx(d,{className:"bg-yellow-600",children:"Warning"});case"error":return e.jsx(d,{className:"bg-red-600",children:"Error"});default:return e.jsx(d,{children:"Unknown"})}})(h.status),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(h.timestamp).toLocaleTimeString()})]})})]}),e.jsxs(l,{className:"space-y-2",children:[null==h?void 0:h.checks.map((s,t)=>e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center justify-between w-full p-2 rounded hover:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[R(s.status),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:s.message}),e.jsx(c,{className:"w-4 h-4"})]})]}),s.details&&e.jsx(b,{className:"pt-2 pl-8",children:e.jsx("pre",{className:"text-xs bg-muted p-2 rounded overflow-auto max-h-32",children:JSON.stringify(s.details,null,2)})})]},t)),e.jsx("div",{className:"pt-4 text-xs text-center text-muted-foreground",children:"Press Ctrl+Shift+D to toggle"})]})]})}):e.jsx(a,{onClick:()=>j(!0),className:"fixed bottom-4 right-4 z-[9999] shadow-lg",size:"sm",variant:"outline",children:"ðŸ” Diagnostics"})}"undefined"!=typeof window&&window.addEventListener("keydown",e=>{if(e.ctrlKey&&e.shiftKey&&"D"===e.key){const e=new CustomEvent("toggle-diagnostics");window.dispatchEvent(e)}});function _(){const[t]=j();if(s.useMemo(()=>(t.get("testErrorBoundary"),false),[t]))throw new Error("Preview health test trigger");return e.jsx("main",{className:"min-h-screen bg-background text-foreground py-16",children:e.jsxs("div",{className:"container max-w-4xl space-y-8",children:[e.jsxs("header",{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-muted-foreground",children:"Preview Environment"}),e.jsx("h1",{className:"text-4xl font-bold",children:"Health Checklist"}),e.jsx("p",{className:"text-muted-foreground",children:"Use this page to verify that the preview build is stable before handing it off for stakeholder review or QA."})]}),e.jsxs(n,{children:[e.jsx(r,{children:e.jsx(i,{children:"Automated diagnostics"})}),e.jsxs(l,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"The widget below runs the same checks exercised by our Preview Environment Health tests, including safe mode detection, error boundary coverage, and service worker status."}),e.jsx(R,{})]})]})]})})}function C(){return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Preview Health â€“ TradeLine 24/7",description:"Diagnostics page for verifying preview builds, safe mode, and error boundaries.",canonical:"https://www.tradeline247ai.com/preview-health",noIndex:!0}),e.jsx(h,{children:e.jsx(_,{})})]})}export{C as default};
