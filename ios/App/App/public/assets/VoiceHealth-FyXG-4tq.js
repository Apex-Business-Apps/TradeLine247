import{j as e}from"./react-query-DHkNQnk-.js";import{r as s}from"./react-vendor-a1y4eqJD.js";import{o as t,j as r,C as l,d,f as i,P as a,g as c,h as n,i as x,B as o,T as m,z as h}from"./index-Dpo-kh1j.js";import{R as j}from"./refresh-cw-D8MiUO2G.js";import{K as u}from"./key-DI33JFjI.js";import{C as v}from"./circle-x-CEMfQcIp.js";import"./radix-primitives-BmowSk35.js";import"./radix-overlays-COL35z5_.js";import"./supabase-Ccy6tpTo.js";import"./react-router-DP697y4K.js";import"./radix-forms-DXrNnkJS.js";function f(){var f,N;const{toast:g}=t(),[p,b]=s.useState(null),[_,w]=s.useState(null),[k,y]=s.useState(!1),S=async()=>{y(!0);try{const[e,s]=await Promise.all([h.functions.invoke("ops-voice-health"),h.functions.invoke("ops-voice-slo")]);if(e.error)throw e.error;if(s.error)throw s.error;b(e.data),w(s.data),g({title:"Health Check Complete",description:"Voice system health status updated"})}catch(e){console.error("Health check error:",e),g({title:"Health Check Failed",description:e.message,variant:"destructive"})}finally{y(!1)}};s.useEffect(()=>{S()},[]);const C=s=>s?e.jsx(x,{className:"h-5 w-5 text-success"}):e.jsx(v,{className:"h-5 w-5 text-error"});return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Voice System Health"}),e.jsx("p",{className:"text-muted-foreground",children:"V-0 Health Gate & V-9 SLO Monitoring"})]}),e.jsxs(r,{onClick:S,disabled:k,children:[e.jsx(j,{className:"mr-2 h-4 w-4 "+(k?"animate-spin":"")}),"Refresh"]})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{className:"border-primary",children:[e.jsxs(d,{children:[e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(a,{className:"h-5 w-5"}),"Place Test Call"]}),e.jsx(c,{children:"Call the Twilio number to verify voice integration (V-8 Production Test)"})]}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Test Number:"}),e.jsx("p",{className:"text-3xl font-bold font-mono",children:(null==(N=null==(f=p.twilioNumbers)?void 0:f[0])?void 0:N.e164)||"Not configured"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Test Checklist:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-muted rounded",children:[e.jsx(x,{className:"h-4 w-4 text-success mt-0.5 shrink-0"}),e.jsx("span",{children:'Greeting: "Hi, you\'ve reached TradeLine 24/7 — Your 24/7 AI Receptionist!"'})]}),e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-muted rounded",children:[e.jsx(x,{className:"h-4 w-4 text-success mt-0.5 shrink-0"}),e.jsx("span",{children:"LLM responds within 2 seconds"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-muted rounded",children:[e.jsx(x,{className:"h-4 w-4 text-success mt-0.5 shrink-0"}),e.jsx("span",{children:"Press 0 → bridges to +14319900222"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-muted rounded",children:[e.jsx(x,{className:"h-4 w-4 text-success mt-0.5 shrink-0"}),e.jsx("span",{children:"Transcript emailed to jrmendozaceo@apexbusiness-systems.com"})]})]})]})]})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Environment Secrets"]}),e.jsx(c,{children:"Required environment variables (names only)"})]}),e.jsx(n,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(p.secrets).map(([s,t])=>e.jsxs("div",{className:"flex items-center gap-2",children:[C(t),e.jsx("span",{className:"font-mono text-sm",children:s})]},s))})})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"Active Twilio Numbers"}),e.jsx(c,{children:"Configured phone numbers and webhook URLs"})]}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[p.twilioNumbers.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:s.e164}),e.jsx(o,{variant:s.active?"default":"secondary",children:s.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Voice Answer: ",s.voice_answer_url||"Not set"]}),e.jsxs("div",{children:["Voice Status: ",s.voice_status_url||"Not set"]})]})]},s.id)),0===p.twilioNumbers.length&&e.jsx("p",{className:"text-muted-foreground",children:"No active numbers configured"})]})})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"Voice Configuration"}),e.jsx(c,{children:"Current pickup and LLM settings"})]}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pickup Mode"}),e.jsx("div",{className:"font-semibold",children:p.config.pickup_mode})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pickup Rings"}),e.jsxs("div",{className:"font-semibold",children:[p.config.pickup_rings," rings"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pickup Seconds"}),e.jsxs("div",{className:"font-semibold",children:["~",p.config.pickup_seconds,"s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LLM Enabled"}),e.jsxs("div",{className:"flex items-center gap-2",children:[C(p.config.llm_enabled),e.jsx("span",{className:"font-semibold",children:p.config.llm_enabled?"Enabled":"Disabled"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Panic Mode"}),e.jsx("div",{className:"flex items-center gap-2",children:p.config.panic_mode?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"h-5 w-5 text-error"}),e.jsx("span",{className:"font-semibold text-error",children:"ACTIVE"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"h-5 w-5 text-success"}),e.jsx("span",{className:"font-semibold",children:"Off"})]})})]})]})})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"Webhook Stats (Last 15 Minutes)"}),e.jsx(c,{children:"Recent webhook request status codes"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Requests"}),e.jsx("div",{className:"text-2xl font-bold",children:p.webhookStats.total})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Success (2xx)"}),e.jsx("div",{className:"text-2xl font-bold text-success",children:p.webhookStats.success_2xx})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Client Errors (4xx)"}),e.jsx("div",{className:"text-2xl font-bold text-amber-800",children:p.webhookStats.error_4xx})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Server Errors (5xx)"}),e.jsx("div",{className:"text-2xl font-bold text-error",children:p.webhookStats.error_5xx})]})]}),(p.webhookStats.error_4xx>0||p.webhookStats.error_5xx>0)&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[e.jsx(m,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Warning:"}),e.jsx("span",{children:"Detected webhook errors in the last 15 minutes"})]})})]})]})]}),_&&e.jsxs(e.Fragment,{children:[_.alerts.length>0&&e.jsxs(l,{className:"border-red-200 bg-red-50",children:[e.jsxs(d,{children:[e.jsx(i,{className:"text-red-800",children:"SLO Alerts"}),e.jsx(c,{children:"Threshold breaches detected"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:_.alerts.map((s,t)=>{return e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white rounded-lg border border-red-200",children:[e.jsx(m,{className:"h-5 w-5 text-red-700 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:s.metric}),e.jsx(o,{variant:(r=s.severity,"critical"===r?"destructive":"secondary"),children:s.severity})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.message})]})]},t);var r})})})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"SLO Metrics (24h Window)"}),e.jsx(c,{children:"Service Level Objectives and thresholds"})]}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"P95 Ring Seconds"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.p95_ring_seconds,"s"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Threshold: ≤",_.thresholds.p95_ring_seconds,"s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Handoff Rate"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.handoff_rate,"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Threshold: ",_.thresholds.handoff_rate_min,"-",_.thresholds.handoff_rate_max,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"AMD Rate"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.amd_rate,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Consent Decline Rate"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.consent_decline_rate,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LLM Error Rate"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.llm_stream_error_rate,"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Threshold: <",_.thresholds.llm_stream_error_rate,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"P95 Transcript Latency"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.transcript_latency_p95,"s"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Threshold: ≤",_.thresholds.transcript_latency_p95,"s"]})]}),void 0!==_.slos.realtime_handshake_p50_ms&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Realtime P50 Handshake"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.realtime_handshake_p50_ms,"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Realtime P95 Handshake"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.realtime_handshake_p95_ms,"ms"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Threshold: ≤",_.thresholds.realtime_handshake_p95_ms||1500,"ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Realtime Fallback Rate"}),e.jsxs("div",{className:"text-2xl font-bold",children:[_.slos.realtime_fallback_rate,"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Threshold: <",_.thresholds.realtime_fallback_rate_max||5,"%"]})]})]})]})})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"Call Metrics (24h Window)"}),e.jsx(c,{children:"Detailed call statistics"})]}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Calls"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.total_calls})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LLM Calls"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.llm_calls})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Bridge Calls"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.bridge_calls})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Handoffs"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.handoffs})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"AMD Detected"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.amd_detected})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Consent Declined"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.consent_declined})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"LLM Errors"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.llm_errors})]}),void 0!==_.metrics.realtime_streams&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Realtime Streams"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.realtime_streams})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Realtime Fallbacks"}),e.jsx("div",{className:"text-2xl font-bold",children:_.metrics.realtime_fallbacks||0})]})]})]})})]})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"Validation Checklist"}),e.jsx(c,{children:"V-0 through V-11 acceptance criteria"})]}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p&&Object.values(p.secrets).every(e=>e)?e.jsx(x,{className:"h-5 w-5 text-success"}):e.jsx(v,{className:"h-5 w-5 text-error"}),e.jsx("span",{children:"V-0: All environment secrets present"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p&&0===p.webhookStats.error_4xx&&0===p.webhookStats.error_5xx?e.jsx(x,{className:"h-5 w-5 text-success"}):e.jsx(v,{className:"h-5 w-5 text-error"}),e.jsx("span",{children:"V-0: No 4xx/5xx errors in last 15 minutes"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&0===_.alerts.length?e.jsx(x,{className:"h-5 w-5 text-success"}):e.jsx(m,{className:"h-5 w-5 text-amber-800"}),e.jsx("span",{children:"V-9: All SLOs within thresholds"})]})]})})]})]})}export{f as default};
