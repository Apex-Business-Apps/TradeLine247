import{j as e}from"./react-query-DHkNQnk-.js";import{r as t,e as s}from"./react-vendor-a1y4eqJD.js";import{a as r,a7 as a,aa as n,k as o,o as i,V as l,e as d}from"./index-Dpo-kh1j.js";import{M as c}from"./message-circle-BQiBSR1G.js";import{p as m,d as u,b as h}from"./performanceOptimizations-DPwb1cGZ.js";import{S as x}from"./send-BXSmw3Ye.js";import"./radix-primitives-BmowSk35.js";import"./radix-overlays-COL35z5_.js";import"./supabase-Ccy6tpTo.js";import"./react-router-DP697y4K.js";import"./radix-forms-DXrNnkJS.js";
/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=r("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);const g={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"},p={sm:16,md:24,lg:32,xl:48},b=({size:s="md",className:r,alt:a="TradeLine 24/7 AI Assistant",...n})=>{const[i,l]=t.useState(!1);return i?e.jsx(c,{size:p[s],className:o(g[s],r),"aria-label":a}):e.jsx("img",{src:"/assets/brand/TRADELEINE_ROBOT_V2.svg",alt:a,className:o(g[s],"object-contain flex-shrink-0",r),loading:n.loading||"eager",onError:()=>l(!0),onLoad:()=>l(!1),...n})},y=e=>{const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/6e4);return s<1?"Just now":s<60?`${s}m ago`:s<1440?`${Math.floor(s/60)}h ago`:e.toLocaleDateString()},v=s.memo(()=>{const[s,r]=t.useState(!1),[c,g]=t.useState([]),[p,v]=t.useState(""),[j,w]=t.useState(!1),N=t.useRef(null),k=t.useRef(null),E=t.useRef(null),{toast:D}=i(),T=t.useCallback(()=>{N.current&&(m()?N.current.scrollIntoView({behavior:"auto"}):N.current.scrollIntoView({behavior:"smooth"}))},[]),S=t.useMemo(()=>u(T,50),[T]);t.useEffect(()=>{h(S)},[c,S]),t.useEffect(()=>{s&&k.current&&k.current.focus()},[s]);const I=async()=>{if(!p.trim()||j)return;const e={id:crypto.randomUUID(),role:"user",content:p.trim(),timestamp:new Date};g(t=>[...t,e]),v(""),w(!0);const t=crypto.randomUUID(),s={id:t,role:"assistant",content:"",timestamp:new Date};g(e=>[...e,s]);try{c.length,await async function(e,t={}){var s,r,o,i;const{onChunk:l,onComplete:d,onError:c,signal:m}=t;try{const t=await fetch(a.chat,{method:"POST",headers:n(),body:JSON.stringify({messages:e}),signal:m});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const c=null==(s=t.body)?void 0:s.getReader();if(!c)throw new Error("No response body");const h=new TextDecoder;let x="";for(;;){const{done:e,value:t}=await c.read();if(e)break;const s=h.decode(t,{stream:!0}).split("\n");for(const a of s)if(a.startsWith("data: ")){const e=a.slice(6);if("[DONE]"===e)return null==d||d(x),x;try{const t=(null==(i=null==(o=null==(r=JSON.parse(e).choices)?void 0:r[0])?void 0:o.delta)?void 0:i.content)||"";t&&(x+=t,null==l||l(t))}catch(u){console.warn("Invalid JSON chunk:",e)}}}return null==d||d(x),x}catch(h){const e=h instanceof Error?h:new Error(String(h));throw null==c||c(e),e}}([...c,e].map(e=>({role:e.role,content:e.content})),{onChunk:e=>{g(s=>s.map(s=>s.id===t?{...s,content:s.content+e}:s))},onComplete:e=>{e.length,w(!1)},onError:e=>{var s,r;d.report({type:"error",message:`Chat stream error: ${e.message}`,stack:e.stack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:d.getEnvironment(),metadata:{messageCount:c.length}}),console.error("Chat stream error:",e);let a="Sorry, I encountered an error. Please try again.";(null==(s=e.message)?void 0:s.includes("429"))?a="I'm receiving too many requests right now. Please wait a moment and try again.":(null==(r=e.message)?void 0:r.includes("402"))&&(a="The AI service is temporarily unavailable. Please try again later."),g(e=>e.map(e=>e.id===t?{...e,content:a}:e)),w(!1),D({title:"Chat Error",description:a,variant:"destructive"})}})}catch(r){console.error("Chat error:",r),w(!1)}};return t.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&r(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),t.useEffect(()=>()=>{E.current&&(clearTimeout(E.current),E.current=null)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{r(!0),0===c.length&&(E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{const e={id:crypto.randomUUID(),role:"assistant",content:"Hello! I'm here to help you with questions about TradeLine 24/7's AI receptionist services. How can I assist you today?",timestamp:new Date};g([e]),E.current=null},300))},"aria-expanded":s,"aria-controls":"mini-chat-dialog",className:o("fixed right-4 bottom-4 sm:bottom-4 max-sm:bottom-20 z-[60] rounded-full shadow-lg","p-3 bg-primary hover:bg-primary/90 text-primary-foreground","transition-all duration-300 hover:scale-110 active:scale-95","flex items-center justify-center","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",!s&&"animate-bounce-subtle hover:animate-none"),children:[e.jsx("span",{className:"sr-only",children:"Open chat"}),e.jsx(b,{size:"md",className:"w-[22px] h-[22px] brightness-0 invert","aria-hidden":"true",loading:"eager"}),c.length>0&&!s&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-background animate-pulse","aria-label":"Unread messages"})]}),s&&e.jsxs("div",{id:"mini-chat-dialog",role:"dialog","aria-modal":"true","aria-labelledby":"mini-chat-title",className:"fixed right-4 bottom-20 z-[60] w-[360px] max-w-[90vw] h-[500px] rounded-2xl shadow-2xl bg-background/95 backdrop-blur-sm border border-border/50 flex flex-col animate-in slide-in-from-bottom-5 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-primary/5 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(b,{size:"sm",className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{id:"mini-chat-title",className:"text-base font-semibold text-foreground",children:"TradeLine 24/7 Assistant"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Online • Usually replies instantly"})]})]}),e.jsx("button",{onClick:()=>{r(!1)},className:"text-muted-foreground hover:text-foreground transition-colors p-1 rounded-md hover:bg-accent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring","aria-label":"Minimize chat",children:e.jsx(f,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth",children:[0===c.length&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8 px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4 animate-pulse",children:e.jsx(b,{size:"lg",className:"w-8 h-8"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Start a conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ask me anything about TradeLine 24/7"})]}),c.map((t,s)=>{const r=s>=c.length-3&&!m();return e.jsxs("div",{className:o("flex items-start gap-3","user"===t.role?"justify-end":"justify-start",r&&"animate-in fade-in slide-in-from-bottom-2 duration-300"),style:r?{animationDelay:`${Math.min(30*s,150)}ms`}:void 0,children:["assistant"===t.role&&e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary flex items-center justify-center flex-shrink-0 overflow-hidden shadow-sm",children:e.jsx(b,{size:"sm",className:"w-4 h-4 brightness-0 invert"})}),e.jsxs("div",{className:"flex flex-col gap-1 max-w-[80%]",children:[e.jsx("div",{className:o("rounded-2xl px-4 py-2.5 text-sm leading-relaxed shadow-sm","user"===t.role?"bg-primary text-primary-foreground rounded-br-sm":"bg-muted text-foreground rounded-bl-sm"),children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:t.content})}),e.jsx("span",{className:o("text-xs text-muted-foreground px-2","user"===t.role?"text-right":"text-left"),children:y(t.timestamp)})]}),"user"===t.role&&e.jsx("div",{className:"w-7 h-7 rounded-full bg-muted flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(l,{size:14,className:"text-muted-foreground"})})]},t.id)}),j&&e.jsxs("div",{className:"flex items-start gap-3 animate-in fade-in duration-300",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary flex items-center justify-center flex-shrink-0 overflow-hidden shadow-sm",children:e.jsx(b,{size:"sm",className:"w-4 h-4 brightness-0 invert"})}),e.jsx("div",{className:"bg-muted text-foreground rounded-2xl rounded-bl-sm px-4 py-3 flex items-center gap-2 shadow-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:N})]}),e.jsxs("div",{className:"p-4 border-t bg-gradient-to-t from-background to-background/95",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:k,type:"text",value:p,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),I())},placeholder:"Type your message...",disabled:j,className:o("w-full px-4 py-2.5 pr-10 border rounded-2xl bg-background text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent","disabled:opacity-50 disabled:cursor-not-allowed","transition-all duration-200",p.trim()&&"shadow-sm"),"aria-label":"Chat input"}),p.trim().length>0&&e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-muted-foreground",children:"Press Enter to send"})]}),e.jsx("button",{onClick:I,disabled:!p.trim()||j,className:o("px-4 py-2.5 bg-primary text-primary-foreground rounded-2xl","hover:bg-primary/90 active:scale-95","disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100","transition-all duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","shadow-sm hover:shadow-md"),"aria-label":"Send message",children:e.jsx(x,{size:18,className:o("transition-transform duration-200",p.trim()&&"translate-x-0.5 translate-y-0.5")})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 px-1",children:["AI-powered responses • ",c.length>0&&`${c.length} message${1!==c.length?"s":""}`]})]})]})]})});export{v as MiniChat};
