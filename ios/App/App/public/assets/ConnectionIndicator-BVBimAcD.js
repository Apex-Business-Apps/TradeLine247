import{j as e}from"./react-query-DHkNQnk-.js";import{r as t,e as n}from"./react-vendor-a1y4eqJD.js";import{a as o,D as i,k as r}from"./index-Dpo-kh1j.js";import{p as a}from"./performanceOptimizations-DPwb1cGZ.js";import"./radix-primitives-BmowSk35.js";import"./radix-overlays-COL35z5_.js";import"./supabase-Ccy6tpTo.js";import"./react-router-DP697y4K.js";import"./radix-forms-DXrNnkJS.js";
/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=o("signal-high",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}]]),s=o("signal-low",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}]]),u=o("signal-medium",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}]]),c=o("signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]),d=o("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),f=[1e3,2e3,4e3];function m(e){if(!e)return"unknown";const t=e.effectiveType;return"wifi"===e.type?"wifi":"4g"===t&&e.downlink&&e.downlink>10?"5g":"4g"===t?"4g":"3g"===t?"3g":"2g"===t||"slow-2g"===t?"2g":"unknown"}function p(e,t,n,o){return"4g"===t&&n&&n>10?"excellent":"4g"===t||"3g"===t||n&&n>1.5?"good":"slow"}function y(e,t,n){return n&&"offline"!==e?"excellent"===t?`Connected with ${"wifi"===e?"WiFi":e.toUpperCase()} - Excellent connection.`:"good"===t?`Connected with ${"wifi"===e?"WiFi":e.toUpperCase()} - Good connection.`:"slow"===t?`Connected with ${"wifi"===e?"WiFi":e.toUpperCase()} - Slow connection. Some features may be limited.`:"Connection status: "+(n?"Online":"Offline"):"You are currently offline. Some features may be unavailable."}const h=n.memo(({showOnlyWhenIssues:n=!0,position:o="bottom-right",className:h})=>{const{status:v,queuedRequestCount:w}=function(){const[e,n]=t.useState(()=>{const e="undefined"==typeof navigator||navigator.onLine,t=navigator,n=t.connection||t.mozConnection||t.webkitConnection;return{online:e,type:e?m(n):"offline",quality:e?p(0,null==n?void 0:n.effectiveType,null==n?void 0:n.downlink,null==n||n.rtt):"offline",downlink:null==n?void 0:n.downlink,rtt:null==n?void 0:n.rtt,effectiveType:null==n?void 0:n.effectiveType,saveData:null==n?void 0:n.saveData}}),o=t.useRef(new Map),i=t.useRef(new Map),r=t.useCallback(()=>{const e=navigator.onLine,t=navigator,i=t.connection||t.mozConnection||t.webkitConnection,r={online:e,type:e?m(i):"offline",quality:e?p(0,null==i?void 0:i.effectiveType,null==i?void 0:i.downlink,null==i||i.rtt):"offline",downlink:null==i?void 0:i.downlink,rtt:null==i?void 0:i.rtt,effectiveType:null==i?void 0:i.effectiveType,saveData:null==i?void 0:i.saveData};n(r),e&&o.current.size>0&&s()},[]),a=t.useCallback((t,n)=>{const i=n||`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return new Promise((n,r)=>{const a={id:i,request:t,retries:0,timestamp:Date.now(),resolve:n,reject:r};o.current.set(i,a),e.online&&l(a)})},[e.online]),l=t.useCallback(async e=>{try{const t=await e.request();e.resolve(t),o.current.delete(e.id),i.current.delete(e.id)}catch(t){if(e.retries++,e.retries>=3)return e.reject(t),o.current.delete(e.id),void i.current.delete(e.id);const n=f[e.retries-1]||4e3,r=setTimeout(()=>{l(e),i.current.delete(e.id)},n);i.current.set(e.id,r)}},[]),s=t.useCallback(()=>{e.online&&o.current.forEach(e=>{i.current.has(e.id)||l(e)})},[e.online,l]),u=t.useCallback(()=>{o.current.forEach(e=>{e.reject(new Error("Request queue cleared"))}),o.current.clear(),i.current.forEach(e=>clearTimeout(e)),i.current.clear()},[]);return t.useEffect(()=>{r(),window.addEventListener("online",r),window.addEventListener("offline",r);const e=navigator,t=e.connection||e.mozConnection||e.webkitConnection;return(null==t?void 0:t.addEventListener)&&t.addEventListener("change",r),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",r),(null==t?void 0:t.removeEventListener)&&t.removeEventListener("change",r),i.current.forEach(e=>clearTimeout(e))}},[r]),{status:e,isOnline:e.online,isOffline:!e.online,networkType:e.type,connectionQuality:e.quality,queueRequest:a,clearQueue:u,hasQueuedRequests:o.current.size>0,queuedRequestCount:o.current.size}}(),{user:k,isAdmin:g,userRole:x}=i(),[b,j]=t.useState(!1),[q,C]=t.useState(!1),M=!!k&&("function"==typeof g?g():"admin"===x||"owner"===x);t.useEffect(()=>{j(!n||(!v.online||"slow"===v.quality||"offline"===v.quality))},[v.online,v.quality,n]),t.useEffect(()=>{if(!b||q)return;const e=y(v.type,v.quality,v.online),t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=e,document.body.appendChild(t);const n=setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t),C(!0)},1e3);return()=>{clearTimeout(n),document.body.contains(t)&&document.body.removeChild(t)}},[b,v.type,v.quality,v.online,q]),t.useEffect(()=>{C(!1)},[v.online,v.type,v.quality]);const E="slow"===v.quality&&!M;if(!b||E)return null;const N=!a(),T=y(v.type,v.quality,v.online),z=function(e){switch(e){case"excellent":return"text-success dark:text-green-400";case"good":return"text-info dark:text-blue-400";case"slow":return"text-amber-800 dark:text-yellow-400";case"offline":return"text-red-700 dark:text-red-400";default:return"text-muted-foreground"}}(v.quality);return e.jsxs("div",{className:r("fixed z-50 flex items-center gap-2 rounded-lg border bg-background/95 backdrop-blur-sm px-3 py-2 shadow-lg",{"top-right":"top-4 right-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4","top-left":"top-4 left-4"}[o],N&&"animate-in slide-in-from-bottom-2",h),role:"status","aria-live":"polite","aria-label":T,children:[e.jsx("div",{className:r("flex-shrink-0",z),children:(L=v.type,R=v.quality,"offline"===L||"offline"===R?e.jsx(d,{className:"h-4 w-4"}):"excellent"===R||"wifi"===L||"5g"===L?e.jsx(l,{className:"h-4 w-4"}):"good"===R||"4g"===L?e.jsx(u,{className:"h-4 w-4"}):"slow"===R?e.jsx(s,{className:"h-4 w-4"}):e.jsx(c,{className:"h-4 w-4"}))}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-xs font-medium truncate",children:v.online?"slow"===v.quality?"Slow Connection":"Connected":"Offline"}),w>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[w," request",w>1?"s":""," queued"]})]}),e.jsx("span",{className:"sr-only",children:T})]});var L,R});export{h as ConnectionIndicator};
